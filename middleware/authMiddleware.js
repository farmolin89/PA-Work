// ===================================================================
// Файл: middleware/authMiddleware.js (ПОЛНАЯ ИТОГОВАЯ ВЕРСИЯ)
// ===================================================================

/**
 * Middleware для проверки, что пользователь АВТОРИЗОВАН.
 * Если пользователь не авторизован, его перенаправляет на страницу входа.
 */
exports.isAuthenticated = (req, res, next) => {
    if (req.session.user) {
        // Пользователь авторизован, продолжаем выполнение запроса
        return next();
    }
    // Пользователь не авторизован, отправляем на страницу входа
    res.redirect('/');
};

/**
 * Middleware для проверки, что пользователь НЕ АВТОРИЗОВАН.
 * Если пользователь уже авторизован, его перенаправляет на дашборд.
 * Используется для страниц входа/регистрации.
 */
exports.isNotAuthenticated = (req, res, next) => {
    if (!req.session.user) {
        // Пользователь не авторизован, разрешаем доступ (например, к странице входа)
        return next();
    }
    // Пользователь уже вошел в систему, отправляем его на дашборд
    res.redirect('/dashboard');
};